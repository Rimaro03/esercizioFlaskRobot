<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.4/raphael-min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/justgage/1.2.9/justgage.min.js"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"
      integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA=="
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="../static/style.css" />
    <title>Document</title>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <div class="sx">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#"
                  >Dashboard</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#"
                  >Centro di Controllo</a
                >
              </li>
            </div>
            <div class="dx">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="https://github.com/Rimaro03/esercizioFlaskRobot"
                  >GitHub
                  <img
                    src="https://github.githubassets.com/favicons/favicon.png"
                    alt=""
                /></a>
              </li>
            </div>
          </ul>
        </div>
      </div>
    </nav>
    <div class="container">
      <div id="g1" class="gaudge"></div>
      <div id="g2" class="gaudge"></div>
      <canvas id="myChart"></canvas>
    </div>

    <script>
      var socket = io();

      document.addEventListener("DOMContentLoaded", function(event) {
          var g1 = new JustGage({
              id: "g1",
              value: {{temp}},
              min: 0,
              max: 50,
              title: "Temperatura",
              levelColors:	["#a9d70b", "#f9c802", "#ff0000"],
              humanFriendly: false,
              donut: false,
              pointer: true,
              symbol: "°C",
              percents: true,
              relativeGaugeSize: false,
              donut: true,
          });

          var g2 = new JustGage({
              id: "g2",
              value: {{umi}},
              min: 0,
              max: 100,
              title: "Umidità",
              levelColors:	["#a9d70b", "#f9c802", "#ff0000"],
              humanFriendly: false,
              donut: false,
              pointer: true,
              symbol: "%",
              percents: true,
              relativeGaugeSize: false,
              donut: true,
          });
          g2.relativeGaugeSize = false;

          setInterval(() => {
              socket.emit('getData')
              socket.on('response', function(data) {
                  g1.refresh(data.temp);
                  g2.refresh(data.umi);
              });
          }, 2000)
      });
    </script>

    <script>
      socket.emit("getMoreData");
      socket.on("response", function (dati) {
        let labels = [];
        dati.timestamp.forEach((element) => {
          labels.push(
            `${new Date(element).getDate()}/${new Date(element).getMonth() + 1}`
          );
          console.log(element);
        });
        console.log(labels);
        const data = {
          labels: labels,
          datasets: [
            {
              label: "My First dataset",
              backgroundColor: "rgb(242, 150, 70)",
              borderColor: "rgb(242, 150, 70)",
              data: dati.temp,
            },
          ],
        };

        const config = {
          type: "line",
          data: data,
          options: {},
        };

        const myChart = new Chart(document.getElementById("myChart"), config);

        document.addEventListener("DOMContentUnload", function () {
          myChart.destroy();
        });
      });
    </script>
  </body>
</html>
